{"version":3,"file":"tigerlily.modern.js","sources":["../node_modules/floodplains/dist/floodplains.module.js","../src/tigerlily.js"],"sourcesContent":["function r(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function t(t,e){var n;if(\"undefined\"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if(\"string\"==typeof t)return r(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===n&&t.constructor&&(n=t.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(t):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,void 0):void 0}}(t))||e&&t&&\"number\"==typeof t.length){n&&(t=n);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}return(n=t[Symbol.iterator]()).next.bind(n)}var e={},n={emit:function(r,n){for(var o,a=t(e[r]||[]);!(o=a()).done;)(0,o.value)({name:r,value:n})},on:function(r,n){for(var o,a=t(Array.isArray(r)?r:[r]);!(o=a()).done;){var i=o.value;e[i]||(e[i]=[]),e[i].push(n)}}};export default n;\n//# sourceMappingURL=floodplains.module.js.map\n","/*\n\n// uses existing db if present\nlet db = new tigerlily(\"jMpHXDYguqtS\", {\n  defaults: {\n    x: 123\n  }\n}); \n\ndb.x = \"hello\";\n// page reload\ndb.x === \"hello\"; // true\n\ndb.num = 0;\ndb.num++;\n\n\ndb.on(\"num\", ({name, oldValue, newValue}) => {\n  console.log({name, oldValue, newValue});\n});\n\ndb.on([\"x\", \"num\"], ({name, oldValue, newValue}) => {\n  console.log({name, oldValue, newValue});\n});\n\n*/\n\nimport floodplains from \"floodplains\";\n\nexport default (dbName, options = {}) => {\n  if (typeof dbName !== \"string\") {\n    throw new Error('tigerlily requires a database name');\n  }\n\n  // get default options\n  const { defaults = {} } = options;\n\n  // get initial db state\n  let state = JSON.parse(localStorage.getItem(dbName) || \"{}\");\n\n  // assign defaults as starting data (don't overwrite existing data)\n  state = Object.assign(defaults, state);\n\n  function boundHandler (rootRef) {\n    return {\n      get (obj, prop) {\n        if (typeof obj[prop] === 'object' && obj[prop] !== null) {\n          // if nested object, wrap it in a Proxy\n          return new Proxy(obj[prop], boundHandler(rootRef));\n        } else {\n          return obj[prop];\n        }\n      },\n      set (obj, prop, value) {\n        let oldValue = obj[prop];\n        obj[prop] = value;\n        localStorage.setItem(dbName, JSON.stringify(rootRef));\n\n        if (prop !== \"on\") {\n          floodplains.emit(prop, value);\n        }\n\n        return true;\n      }\n    }\n  }\n\n  let proxiedObject = new Proxy(state, boundHandler(state));\n\n  proxiedObject.on = floodplains.on;\n\n  return proxiedObject;\n\n}\n\n\n\n"],"names":["r","t","length","e","n","Array","Symbol","iterator","isArray","Object","prototype","toString","call","slice","constructor","name","from","test","o","done","value","TypeError","next","bind","a","i","push","dbName","options","Error","defaults","state","JSON","parse","localStorage","getItem","assign","proxiedObject","Proxy","boundHandler","rootRef","get","obj","prop","set","setItem","stringify","floodplains","on"],"mappings":"AAAA,SAASA,EAAEA,EAAEC,IAAI,MAAMA,GAAGA,EAAED,EAAEE,UAAUD,EAAED,EAAEE,QAAQ,IAAI,IAAIC,EAAE,EAAEC,EAAE,IAAIC,MAAMJ,GAAGE,EAAEF,EAAEE,IAAIC,EAAED,GAAGH,EAAEG,GAAG,OAAOC,EAAE,SAASH,EAAEA,EAAEE,GAAG,IAAIC,EAAE,GAAG,oBAAoBE,QAAQ,MAAML,EAAEK,OAAOC,UAAU,CAAC,GAAGF,MAAMG,QAAQP,KAAKG,EAAE,SAASH,EAAEE,GAAG,GAAGF,EAAE,CAAC,GAAG,iBAAiBA,EAAE,OAAOD,EAAEC,OAAE,GAAQ,IAAIG,EAAEK,OAAOC,UAAUC,SAASC,KAAKX,GAAGY,MAAM,GAAG,GAAG,MAAM,WAAWT,GAAGH,EAAEa,cAAcV,EAAEH,EAAEa,YAAYC,MAAM,QAAQX,GAAG,QAAQA,EAAEC,MAAMW,KAAKf,GAAG,cAAcG,GAAG,2CAA2Ca,KAAKb,GAAGJ,EAAEC,OAAE,QAAQ,GAA9R,CAAuSA,KAAKE,GAAGF,GAAG,iBAAiBA,EAAEC,OAAO,CAACE,IAAIH,EAAEG,GAAG,IAAIc,EAAE,EAAE,OAAO,WAAW,OAAOA,GAAGjB,EAAEC,OAAO,CAACiB,MAAK,GAAI,CAACA,MAAK,EAAGC,MAAMnB,EAAEiB,OAAO,MAAM,IAAIG,UAAU,yIAAyI,OAAOjB,EAAEH,EAAEK,OAAOC,aAAae,KAAKC,KAAKnB,GAAG,IAAID,EAAE,GAAGC,EAA+F,SAASJ,EAAEI,GAAG,IAAI,IAAIc,EAAEM,EAAEvB,EAAEI,MAAMG,QAAQR,GAAGA,EAAE,CAACA,MAAMkB,EAAEM,KAAKL,MAAM,CAAC,IAAIM,EAAEP,EAAEE,MAAMjB,EAAEsB,KAAKtB,EAAEsB,GAAG,IAAItB,EAAEsB,GAAGC,KAAKtB,oBC6BngCuB,EAAQC,EAAU,MAChC,GAAsB,iBAAXD,EACT,UAAUE,MAAM,sCAIlB,MAAMC,SAAEA,EAAW,IAAOF,EAG1B,IAAIG,EAAQC,KAAKC,MAAMC,aAAaC,QAAQR,IAAW,MAGvDI,EAAQtB,OAAO2B,OAAON,EAAUC,GA0BhC,IAAIM,EAAgB,IAAIC,MAAMP,EAxB9B,SAASQ,EAAcC,GACrB,MAAO,CACLC,IAAG,CAAEC,EAAKC,IACiB,iBAAdD,EAAIC,IAAoC,OAAdD,EAAIC,OAE5BL,MAAMI,EAAIC,GAAOJ,EAAaC,IAElCE,EAAIC,GAGfC,IAAG,CAAEF,EAAKC,EAAMvB,KACdsB,EACIC,GAAQvB,EACZc,aAAaW,QAAQlB,EAAQK,KAAKc,UAAUN,IAE/B,OAATG,GD1Do0B,SAAS3C,EAAEI,GAAG,IAAI,IAAIc,EAAEM,EAAEvB,EAAEE,EAAEH,IAAI,MAAMkB,EAAEM,KAAKL,OAAM,EAAGD,EAAEE,OAAO,CAACL,KAAKf,EAAEoB,MAAMhB,IC2Dr5B2C,CAAiBJ,EAAMvB,QAQMmB,CAAaR,IAIlD,OAFAM,EAAcW,GAAKD,EAEZV"}