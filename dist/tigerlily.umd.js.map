{"version":3,"file":"tigerlily.umd.js","sources":["../node_modules/floodplains/dist/floodplains.module.js","../node_modules/lodash.isplainobject/index.js","../src/tigerlily.js","../node_modules/deep-for-each/es/index.js"],"sourcesContent":["function r(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function t(t,e){var n;if(\"undefined\"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if(\"string\"==typeof t)return r(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===n&&t.constructor&&(n=t.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(t):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,void 0):void 0}}(t))||e&&t&&\"number\"==typeof t.length){n&&(t=n);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}return(n=t[Symbol.iterator]()).next.bind(n)}var e={},n={emit:function(r,n){for(var o,a=t(e[r]||[]);!(o=a()).done;)(0,o.value)({name:r,value:n})},on:function(r,n){for(var o,a=t(Array.isArray(r)?r:[r]);!(o=a()).done;){var i=o.value;e[i]||(e[i]=[]),e[i].push(n)}}};export default n;\n//# sourceMappingURL=floodplains.module.js.map\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) ||\n      objectToString.call(value) != objectTag || isHostObject(value)) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nmodule.exports = isPlainObject;\n","/*\n\n// uses existing db if present\nlet db = new tigerlily(\"jMpHXDYguqtS\", {\n  defaults: {\n    x: 123\n  }\n}); \n\ndb.x = \"hello\";\n// page reload\ndb.x === \"hello\"; // true\n\ndb.num = 0;\ndb.num++;\n\n\ndb.on(\"num\", ({name, oldValue, newValue}) => {\n  console.log({name, oldValue, newValue});\n});\n\ndb.on([\"x\", \"num\"], ({name, oldValue, newValue}) => {\n  console.log({name, oldValue, newValue});\n});\n\n*/\n\nimport floodplains from \"floodplains\";\nimport deepForEach from 'deep-for-each';\n\nexport default (dbName, options = {}) => {\n  if (typeof dbName !== \"string\") {\n    throw new Error('tigerlily requires a database name');\n  }\n\n  // get default options\n  const { defaults = {} } = options;\n\n  // get initial db state\n  let state = JSON.parse(localStorage.getItem(dbName) || \"{}\");\n\n  // assign defaults as starting data (don't overwrite existing data)\n  state = Object.assign(defaults, state);\n\n  function boundHandler (rootRef) {\n    return {\n      get (obj, prop) {\n        if (typeof obj[prop] === 'object' && obj[prop] !== null) {\n          // if nested object, wrap it in a Proxy\n          return new Proxy(obj[prop], boundHandler(rootRef));\n        } else {\n          return obj[prop];\n        }\n      },\n      set (obj, prop, value) {\n        let oldValue = obj[prop];\n        obj[prop] = value;\n        localStorage.setItem(dbName, JSON.stringify(rootRef));\n\n        if (prop !== \"on\") {\n          let path = getPathOfNestedObject(rootRef, value) || prop;\n          floodplains.emit(path, {prop, path, oldValue, value});\n        }\n\n        return true;\n      }\n    }\n  }\n\n  let proxiedObject = new Proxy(state, boundHandler(state));\n\n  proxiedObject.on = floodplains.on;\n\n  return proxiedObject;\n\n}\n\nfunction getPathOfNestedObject (root, nested) {\n  if (root === nested) {\n    return \"\";\n  }\n\n  let objPath = \"\";\n  deepForEach(root, (value, key, subject, path) => {\n    if (value === nested) {\n      objPath = path;\n    }\n  });\n  return objPath;\n}\n\n\n\n","import isPlainObject from 'lodash.isplainobject';\n\nfunction forEachObject(obj, fn, path) {\n  for (const key in obj) {\n    const deepPath = path ? `${path}.${key}` : key; // Note that we always use obj[key] because it might be mutated by forEach\n\n    fn.call(obj, obj[key], key, obj, deepPath);\n    forEach(obj[key], fn, deepPath);\n  }\n}\n\nfunction forEachArray(array, fn, path) {\n  array.forEach((value, index, arr) => {\n    const deepPath = `${path}[${index}]`;\n    fn.call(arr, value, index, arr, deepPath); // Note that we use arr[index] because it might be mutated by forEach\n\n    forEach(arr[index], fn, deepPath);\n  });\n}\n\nfunction forEach(value, fn, path) {\n  path = path || '';\n\n  if (Array.isArray(value)) {\n    forEachArray(value, fn, path);\n  } else if (isPlainObject(value)) {\n    forEachObject(value, fn, path);\n  }\n}\n\nexport default forEach;"],"names":["r","t","length","e","n","Array","Symbol","iterator","isArray","Object","prototype","toString","call","slice","constructor","name","from","test","o","done","value","TypeError","next","bind","func","transform","a","i","push","objectProto","funcToString","Function","hasOwnProperty","objectCtorString","objectToString","getPrototype","getPrototypeOf","arg","dbName","options","Error","defaults","state","JSON","parse","localStorage","getItem","assign","proxiedObject","Proxy","boundHandler","rootRef","get","obj","prop","set","oldValue","setItem","stringify","path","root","nested","objPath","forEach","fn","array","index","arr","deepPath","forEachArray","isObjectLike","result","isHostObject","proto","Ctor","isPlainObject","key","forEachObject","deepForEach","subject","getPathOfNestedObject","floodplains","on"],"mappings":"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"}